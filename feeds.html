<html>
  <head>
    <script type="text/javascript" src="js/prototype.js"></script>
    <link href=' http://fonts.googleapis.com/css?family=Yanone+Kaffeesatz' rel='stylesheet' type='text/css'>
    <link type="text/css" media="screen" rel="stylesheet" href="css/chromecast.css" charset="utf-8" />          
        
    <script type="text/javascript">
    
      /*  This file is part of ChromeCast (Chrome Extension)
      Copyright (C) 2010 Binomed (binomed.team@gmail.com) 
   
      This library is free software; you can redistribute it and/or 
      modify it under the terms of the GNU Library General Public 
      License as published by the Free Software Foundation; version 2 
      of the License. 
   
      This library is distributed in the hope that it will be useful, 
      but WITHOUT ANY WARRANTY; without even the implied warranty of 
      MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
      Library General Public License for more details. 
   
      You should have received a copy of the GNU Library General Public License 
      along with this library; see the file COPYING.LIB.  If not, write to 
      the Free Software Foundation, Inc., 51 Franklin Street, Fifth Floor, 
      Boston, MA 02110-1301, USA. 
      */ 
      
      var bg = chrome.extension.getBackgroundPage();
                 
      var playing = false;
      var player = $("idplayer");
            
      //var data = {};     
      var feeds = {};
      
      /**
       * Fonction qui vérifie la formation d'une URL
       */             
      function isUrl(s) {
      	var regexp = /(ftp|http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/
      	return regexp.test(s);
      }
      
      /**
       * Fonction qui affiche les feeds
       */             
      function affiche() {
        //data = bg.getPodcasts();
        feeds = bg.getFeeds();
        
        $('podcasts').innerHTML = "";
        for(i = 0; i < feeds.length; i++) {
          
          var metaTab =  new Element("table", {'class':'meta', 'width':'100%'});
          var metaTrElt   = new Element("tr");
         
            var metaTdImg   = new Element("td", {'class':'img_podcast_td', 'width':'70px'});
            var metaTdTitle = new Element("td", {'class':'meta_podcast'});
            var metaTdDel   = new Element("td", {'class':'del_podcast', 'align':'right'});
              
                var imgPC = new Element("img", {'src':feeds[i].img, 'class':'img_podcast'});
                metaTdImg.appendChild(imgPC);
                
                var title = new Element("h2").update(feeds[i].title);
                var subtitle = new Element("p").update(feeds[i].subtitle);
                metaTdTitle.appendChild(title);
                metaTdTitle.appendChild(subtitle);
                
                var imgDel = new Element("img", {'src':'images/delete.png', 'class':'del_feed', 'onclick':'javascript:delFeed("'+feeds[i].url+'")'});
                metaTdDel.appendChild(imgDel);
                
            metaTrElt.appendChild(metaTdImg);
            metaTrElt.appendChild(metaTdTitle);
            metaTrElt.appendChild(metaTdDel);
          
          metaTab.appendChild(metaTrElt); 
          
          $('podcasts').appendChild(metaTab);   
          
          var tableElt = new Element("table", {'class':'results'});
          
          for(j = 0; j < feeds[i].podcasts.length; j++) {
            var podcast = {};
                              
            var trElt = new Element("tr");
            
              // Titre
              var tdTitre = new Element("td", {'class':'podname', 'id':feeds[i].podcasts[j].guid}).update(feeds[i].podcasts[j].subtitle);
              var tdURL = new Element("td", {'class':'playbutton'});
            
                var button = new Element("button", {'idplay':''+j,'onclick':'play("'+i+'", "'+j+'")'}).update("Play");
            
              tdURL.appendChild(button);
            
            if(j%2 == 0) {
              tdTitre.addClassName('odd');
              tdURL.addClassName('odd');
            } else {
              tdTitre.addClassName('even');
              tdURL.addClassName('even');
            }
            
            trElt.appendChild(tdTitre);
            trElt.appendChild(tdURL);
            
            
            tableElt.appendChild(trElt);         
          }
                                                                   
          $('podcasts').appendChild(tableElt); 
          $('podcasts').appendChild(new Element("hr"));
        }
      }
         
      /**
       * Fonction qui ajoute un feed
       */                
      function addRSS() {
        var feed = $('idUrlPodcast').value;
        
        if(feed != "") {
          if(isUrl(feed)) {                        
            bg.addFeed(feed);                   
            affiche();
          } else {
            alert("Mauvais format URL");
          }
        }
      }
      
      /**
       * Fonction de suppression d'un feed
       */             
      function delFeed(url) {
        if(confirm("Êtes-vous sûr de vouloir supprimer le podcast : " + bg.getTitleByUrl(url) + " ?")) {
          bg.delFeed(url);
        }
      }
      
      /**
       * Fonction qui joue un feed
       */             
      function play(fed, num) {
        bg.togglePlayPodcast(fed, num);
        /*$('nowplaying').innerText = bg.titlePlaying();
        $('imgplaypause').src = 'images/pause.png';*/
        
        /*arrayPodcasts = $$('#podcast tr');
        
        for(i = 0; i < arrayPodcasts.length; i++) {
          arrayTds = arrayPodcasts[i].getElementsByTagName("td");
          arrayTds[0].removeClassName('playing');
          arrayTds[1].removeClassName('playing');
        }
        
        arrayTds = arrayPodcasts[num].getElementsByTagName("td");
        arrayTds[0].addClassName('playing');
        arrayTds[1].addClassName('playing');  */
      }
      
            
    </script>
  </head>
  <body onload="affiche();">
    
    
    <div class="logo"></div>
    <div class="content">
    <h1>Liste des podcasts</h1>
    <span id="feedurl">&nbsp;</span> <input type="text" name="naUrlPodcast" id="idUrlPodcast" /> <button id="validURL" onclick="addRSS();">OK</button>
    
    <div id="podcasts">
    
    </div>
    </div>
   </body>
</html>
